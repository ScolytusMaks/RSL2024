Class inherited СИС2.БазовыйБланк "Библиографическая справка" ;

InClass Private
  Фл_ПРЕКР:logical;             ШР_ПРЕКР:integer;
  Фл_N_ГОСРЕГ:logical;          ШР_N_ГОСРЕГ:integer;
  Фл_ISSN:logical;              ШР_ISSN:integer;
  Фл_НАЗВ:logical;              ШР_НАЗВ:integer;
  Фл_НАЗВ_ИН:logical;           ШР_НАЗВ_ИН:integer;
  Фл_НАЗВ_НАЦ:logical;          ШР_НАЗВ_НАЦ:integer;
  Фл_ПОДЗАГ:logical;            ШР_ПОДЗАГ:integer;
  Фл_ТГ:logical;                ШР_ТГ:integer;
  Фл_ГЕО:logical;               ШР_ГЕО:integer;
  Фл_РЕД:logical;               ШР_РЕД:integer;
  Фл_ТФ:logical;                ШР_ТФ:integer;
  Фл_EMAIL:logical;             ШР_EMAIL:integer;
  Фл_ТИ:logical;                ШР_ТИ:integer;
  Фл_ТЕМ:logical;               ШР_ТЕМ:integer;
  Фл_ЯЗ:logical;                ШР_ЯЗ:integer;
  Фл_ЖАНР:logical;              ШР_ЖАНР:integer;
  Фл_УЧР:logical;               ШР_УЧР:integer;
  Фл_Дата1:logical;             ШР_Дата1:integer;
  Фл_РЕДАКТОР:logical;          ШР_РЕДАКТОР:integer;
  Фл_ГОД_РЕГ:logical;           ШР_ГОД_РЕГ:integer;
  Фл_ПЕРИОДИЧН:logical;         ШР_ПЕРИОДИЧН:integer;
  Фл_СР_РАЗ_ТИРАЖ:logical;      ШР_СР_РАЗ_ТИРАЖ:integer;
  Фл_ЛППИ:logical;              ШР_ЛППИ:integer;
  Фл_ПослНом:logical;           ШР_ПослНом:integer;

InObject Private
  фреймУсловияОтбора            : TemplateFrame;
  фреймНастройкаСтолбцов        : TemplateFrame;
  фреймРезультат                : TemplateFrame;
  секцУсловияОтбора             : Section;
  СекцШапкаСПР                  : Section;
  СекцТелоСПР                   : Section;
  кнНастройка                   : Button;

  ПоказатьНастройку             : logical;
  МестоИздания                  : Record;
  ТипИздания                    : Integer;
  Периодичность                 : String;
  ТерриторияРаспространения     : Record;
  Тематика                      : Record;
  ЧАЦН                          : Record;
  Язык                          : Record;
  ГодНачалаИздания              : Integer;
  ГодЛППИ                       : Integer;
  ГодВыпуска                    : Integer;


  NNN                         []: integer;
  ПРЕКР                       []: logical;
  N_ГОСРЕГ                    []: string;
  ISSN                        []: string;
  НАЗВ                        []: string;
  НАЗВ_ИН                     []: string;
  НАЗВ_НАЦ                    []: string;
  ПОДЗАГ                      []: string;
  ТГ                          []: record;
  ГЕО                         []: record;
  РЕД                         []: record;
  ТФ                          []: string;
  EMAIL                       []: string;
  ТИ                          []: integer;
  ТЕМ                         []: record;
  ЯЗ                          []: record;
  ЖАНР                        []: record;
  УЧР                         []: string;
  Дата1                       []: string;
  РЕДАКТОР_ГАЗЕТЫ             []: string;
  ГОД_РЕГ                     []: integer;
  Периодичность_Газеты        []: string;
  СР_РАЗ_ТИРАЖ                []: numeric;
  ЛППИ                        []: string;
  ПослНом                     []: string;
  --Газета                      []: variant;
  Газета                      []: record;
  --Газета                      []: integer;
--------------------------------------------------------------------------------
  proc ВидСекцииУсловияотбора;
    секцУсловияОтбора.Row[1].Visible    = true;
    секцУсловияОтбора.Row[2].Visible    = true;
    секцУсловияОтбора.Row[3].Visible    = true;
    секцУсловияОтбора.Row[4].Visible    = true;
    секцУсловияОтбора.Row[5].Visible    = true;
    секцУсловияОтбора.Row[6].Visible    = true;
    секцУсловияОтбора.Row[7].Visible    = true;
    секцУсловияОтбора.Row[8].Visible    = true;
    секцУсловияОтбора.Row[9].Visible    = true;
    секцУсловияОтбора.Row[10].Visible   = true;
    секцУсловияОтбора.Row[11].Visible   = true;
    секцУсловияОтбора.Row[12].Visible   = true;
    if МестоИздания                     = nil   then
      секцУсловияОтбора.Row[1].Visible          = false;
    end;
    if ТипИздания                       = nil   then
      секцУсловияОтбора.Row[2].Visible          = false;
    end;
    if Периодичность                    = nil   or
       Периодичность                    = "Все" then
      секцУсловияОтбора.Row[3].Visible          = false;
    end;
    if ТерриторияРаспространения        = nil   then
      секцУсловияОтбора.Row[4].Visible          = false;
      секцУсловияОтбора.Row[5].Visible          = false;
    end;
    if Тематика                         = nil   then
      секцУсловияОтбора.Row[6].Visible          = false;
    end;
    if ЧАЦН                             = nil   then
      секцУсловияОтбора.Row[7].Visible          = false;
      секцУсловияОтбора.Row[8].Visible          = false;
    end;
    if Язык                             = nil   then
      секцУсловияОтбора.Row[9].Visible          = false;
    end;
    if ГодНачалаИздания                 = nil   then
      секцУсловияОтбора.Row[10].Visible         = false;
    end;
    if ГодЛППИ                          = nil   then
      секцУсловияОтбора.Row[11].Visible         = false;
    end;
    if ГодВыпуска                       = nil   then
      секцУсловияОтбора.Row[12].Visible         = false;
    end;
  end;

  Proc ОформитьОтчет;
    if Фл_ПРЕКР:    СекцШапкаСПР.Column[2].Visible = True;  СекцТелоСПР.Column[2].Visible = True;         СекцШапкаСПР.Column[2].Width = ШР_ПРЕКР*1;           СекцТелоСПР.Column[2].Width = ШР_ПРЕКР*1;
    else            СекцШапкаСПР.Column[2].Visible = False; СекцТелоСПР.Column[2].Visible = False;        СекцШапкаСПР.Column[2].Width = 0;                     СекцТелоСПР.Column[2].Width = 0;
    end;
    if Фл_N_ГОСРЕГ: СекцШапкаСПР.Column[3].Visible = True;  СекцТелоСПР.Column[3].Visible = True;         СекцШапкаСПР.Column[3].Width = ШР_N_ГОСРЕГ*1;        СекцТелоСПР.Column[3].Width = ШР_N_ГОСРЕГ*1;
    else            СекцШапкаСПР.Column[3].Visible = False; СекцТелоСПР.Column[3].Visible = False;        СекцШапкаСПР.Column[3].Width = 0;                     СекцТелоСПР.Column[3].Width = 0;
    end;
    if Фл_ISSN:     СекцШапкаСПР.Column[4].Visible = True;  СекцТелоСПР.Column[4].Visible = True;         СекцШапкаСПР.Column[4].Width = ШР_ISSN*1;            СекцТелоСПР.Column[4].Width = ШР_ISSN*1;
    else            СекцШапкаСПР.Column[4].Visible = False; СекцТелоСПР.Column[4].Visible = False;        СекцШапкаСПР.Column[4].Width = 0;                     СекцТелоСПР.Column[4].Width = 0;
    end;
    if Фл_НАЗВ:     СекцШапкаСПР.Column[5].Visible = True;  СекцТелоСПР.Column[5].Visible = True;         СекцШапкаСПР.Column[5].Width = ШР_НАЗВ*1;            СекцТелоСПР.Column[5].Width = ШР_НАЗВ*1;
    else            СекцШапкаСПР.Column[5].Visible = False; СекцТелоСПР.Column[5].Visible = False;        СекцШапкаСПР.Column[5].Width = 0;                     СекцТелоСПР.Column[5].Width = 0;
    end;
    if Фл_НАЗВ_ИН:  СекцШапкаСПР.Column[6].Visible = True;  СекцТелоСПР.Column[6].Visible = True;         СекцШапкаСПР.Column[6].Width = ШР_НАЗВ_ИН*1;         СекцТелоСПР.Column[6].Width = ШР_НАЗВ_ИН*1;
    else            СекцШапкаСПР.Column[6].Visible = False; СекцТелоСПР.Column[6].Visible = False;        СекцШапкаСПР.Column[6].Width = 0;                     СекцТелоСПР.Column[6].Width = 0;
    end;
    if Фл_НАЗВ_НАЦ: СекцШапкаСПР.Column[7].Visible = True;  СекцТелоСПР.Column[7].Visible = True;         СекцШапкаСПР.Column[7].Width = ШР_НАЗВ_НАЦ*1;        СекцТелоСПР.Column[7].Width = ШР_НАЗВ_НАЦ*1;
    else            СекцШапкаСПР.Column[7].Visible = False; СекцТелоСПР.Column[7].Visible = False;        СекцШапкаСПР.Column[7].Width = 0;                     СекцТелоСПР.Column[7].Width = 0;
    end;
    if Фл_ПОДЗАГ:   СекцШапкаСПР.Column[8].Visible = True;  СекцТелоСПР.Column[8].Visible = True;         СекцШапкаСПР.Column[8].Width = ШР_НАЗВ_НАЦ*1;        СекцТелоСПР.Column[8].Width = ШР_НАЗВ_НАЦ*1;
    else            СекцШапкаСПР.Column[8].Visible = False; СекцТелоСПР.Column[8].Visible = False;        СекцШапкаСПР.Column[8].Width = 0;                     СекцТелоСПР.Column[8].Width = 0;
    end;
    if Фл_ТГ:       СекцШапкаСПР.Column[9].Visible = True;  СекцТелоСПР.Column[9].Visible = True;         СекцШапкаСПР.Column[9].Width = ШР_ТГ*1;              СекцТелоСПР.Column[9].Width = ШР_ТГ*1;
    else            СекцШапкаСПР.Column[9].Visible = False; СекцТелоСПР.Column[9].Visible = False;        СекцШапкаСПР.Column[9].Width = 0;                     СекцТелоСПР.Column[9].Width = 0;
    end;
    if Фл_ГЕО:      СекцШапкаСПР.Column[10].Visible = True;  СекцТелоСПР.Column[10].Visible = True;       СекцШапкаСПР.Column[10].Width = ШР_ГЕО*1;            СекцТелоСПР.Column[10].Width = ШР_ГЕО*1;
    else            СекцШапкаСПР.Column[10].Visible = False; СекцТелоСПР.Column[10].Visible = False;      СекцШапкаСПР.Column[10].Width = 0;                    СекцТелоСПР.Column[10].Width = 0;
    end;
    if Фл_РЕД:      СекцШапкаСПР.Column[11].Visible = True;  СекцТелоСПР.Column[11].Visible = True;       СекцШапкаСПР.Column[11].Width = ШР_РЕД*1;            СекцТелоСПР.Column[11].Width = ШР_РЕД*1;
    else            СекцШапкаСПР.Column[11].Visible = False; СекцТелоСПР.Column[11].Visible = False;      СекцШапкаСПР.Column[11].Width = 0;                    СекцТелоСПР.Column[11].Width = 0;
    end;
    if Фл_ТФ:       СекцШапкаСПР.Column[12].Visible = True;  СекцТелоСПР.Column[12].Visible = True;       СекцШапкаСПР.Column[12].Width = ШР_ТФ*1;             СекцТелоСПР.Column[12].Width = ШР_ТФ*1;
    else            СекцШапкаСПР.Column[12].Visible = False; СекцТелоСПР.Column[12].Visible = False;      СекцШапкаСПР.Column[12].Width = 0;                    СекцТелоСПР.Column[12].Width = 0;
    end;
    if Фл_EMAIL:    СекцШапкаСПР.Column[13].Visible = True;  СекцТелоСПР.Column[13].Visible = True;       СекцШапкаСПР.Column[13].Width = ШР_EMAIL*1;          СекцТелоСПР.Column[13].Width = ШР_EMAIL*1;
    else            СекцШапкаСПР.Column[13].Visible = False; СекцТелоСПР.Column[13].Visible = False;      СекцШапкаСПР.Column[13].Width = 0;                    СекцТелоСПР.Column[13].Width = 0;
    end;
    if Фл_ТИ:       СекцШапкаСПР.Column[14].Visible = True;  СекцТелоСПР.Column[14].Visible = True;       СекцШапкаСПР.Column[14].Width = ШР_ТИ*1;             СекцТелоСПР.Column[14].Width = ШР_ТИ*1;
    else            СекцШапкаСПР.Column[14].Visible = False; СекцТелоСПР.Column[14].Visible = False;      СекцШапкаСПР.Column[14].Width = 0;                    СекцТелоСПР.Column[14].Width = 0;
    end;
    if Фл_ТЕМ:      СекцШапкаСПР.Column[15].Visible = True;  СекцТелоСПР.Column[15].Visible = True;       СекцШапкаСПР.Column[15].Width = ШР_ТЕМ*1;            СекцТелоСПР.Column[15].Width = ШР_ТЕМ*1;
    else            СекцШапкаСПР.Column[15].Visible = False; СекцТелоСПР.Column[15].Visible = False;      СекцШапкаСПР.Column[15].Width = 0;                    СекцТелоСПР.Column[15].Width = 0;
    end;
    if Фл_ЯЗ:       СекцШапкаСПР.Column[16].Visible = True;  СекцТелоСПР.Column[16].Visible = True;       СекцШапкаСПР.Column[16].Width = ШР_ЯЗ*1;             СекцТелоСПР.Column[16].Width = ШР_ЯЗ*1;
    else            СекцШапкаСПР.Column[16].Visible = False; СекцТелоСПР.Column[16].Visible = False;      СекцШапкаСПР.Column[16].Width = 0;                    СекцТелоСПР.Column[16].Width = 0;
    end;
    if Фл_ЖАНР:     СекцШапкаСПР.Column[17].Visible = True;  СекцТелоСПР.Column[17].Visible = True;       СекцШапкаСПР.Column[17].Width = ШР_ЖАНР*1;           СекцТелоСПР.Column[17].Width = ШР_ЖАНР*1;
    else            СекцШапкаСПР.Column[17].Visible = False; СекцТелоСПР.Column[17].Visible = False;      СекцШапкаСПР.Column[17].Width = 0;                    СекцТелоСПР.Column[17].Width = 0;
    end;
    if Фл_УЧР:      СекцШапкаСПР.Column[18].Visible = True;  СекцТелоСПР.Column[18].Visible = True;       СекцШапкаСПР.Column[18].Width = ШР_УЧР*1;            СекцТелоСПР.Column[18].Width = ШР_УЧР*1;
    else            СекцШапкаСПР.Column[18].Visible = False; СекцТелоСПР.Column[18].Visible = False;      СекцШапкаСПР.Column[18].Width = 0;                    СекцТелоСПР.Column[18].Width = 0;
    end;
    if Фл_ДАТА1:    СекцШапкаСПР.Column[19].Visible = True;  СекцТелоСПР.Column[19].Visible = True;       СекцШапкаСПР.Column[19].Width = ШР_ДАТА1*1;          СекцТелоСПР.Column[19].Width = ШР_ДАТА1*1;
    else            СекцШапкаСПР.Column[19].Visible = False; СекцТелоСПР.Column[19].Visible = False;      СекцШапкаСПР.Column[19].Width = 0;                    СекцТелоСПР.Column[19].Width = 0;
    end;
    if Фл_РЕДАКТОР: СекцШапкаСПР.Column[20].Visible = True;  СекцТелоСПР.Column[20].Visible = True;       СекцШапкаСПР.Column[20].Width = ШР_РЕДАКТОР*1;       СекцТелоСПР.Column[20].Width = ШР_РЕДАКТОР*1;
    else            СекцШапкаСПР.Column[20].Visible = False; СекцТелоСПР.Column[20].Visible = False;      СекцШапкаСПР.Column[20].Width = 0;                    СекцТелоСПР.Column[20].Width = 0;
    end;
    if Фл_ГОД_РЕГ:  СекцШапкаСПР.Column[21].Visible = True;  СекцТелоСПР.Column[21].Visible = True;       СекцШапкаСПР.Column[21].Width = ШР_ГОД_РЕГ*1;        СекцТелоСПР.Column[21].Width = ШР_ГОД_РЕГ*1;
    else            СекцШапкаСПР.Column[21].Visible = False; СекцТелоСПР.Column[21].Visible = False;      СекцШапкаСПР.Column[21].Width = 0;                    СекцТелоСПР.Column[21].Width = 0;
    end;
    if Фл_ПЕРИОДИЧН:СекцШапкаСПР.Column[22].Visible = True;  СекцТелоСПР.Column[22].Visible = True;       СекцШапкаСПР.Column[22].Width = ШР_ПЕРИОДИЧН*1;      СекцТелоСПР.Column[22].Width = ШР_ПЕРИОДИЧН*1;
    else            СекцШапкаСПР.Column[22].Visible = False; СекцТелоСПР.Column[22].Visible = False;      СекцШапкаСПР.Column[22].Width = 0;                    СекцТелоСПР.Column[22].Width = 0;
    end;
    if Фл_СР_РАЗ_ТИРАЖ:СекцШапкаСПР.Column[23].Visible = True;  СекцТелоСПР.Column[23].Visible = True;   СекцШапкаСПР.Column[23].Width = ШР_СР_РАЗ_ТИРАЖ*1;    СекцТелоСПР.Column[23].Width = ШР_СР_РАЗ_ТИРАЖ*1;
    else               СекцШапкаСПР.Column[23].Visible = False; СекцТелоСПР.Column[23].Visible = False;  СекцШапкаСПР.Column[23].Width = 0;                     СекцТелоСПР.Column[23].Width = 0;
    end;
    if Фл_ЛППИ:     СекцШапкаСПР.Column[24].Visible = True;  СекцТелоСПР.Column[24].Visible = True;       СекцШапкаСПР.Column[24].Width = ШР_ЛППИ*1;           СекцТелоСПР.Column[24].Width = ШР_ЛППИ*1;
    else            СекцШапкаСПР.Column[24].Visible = False; СекцТелоСПР.Column[24].Visible = False;      СекцШапкаСПР.Column[24].Width = 0;                    СекцТелоСПР.Column[24].Width = 0;
    end;
    if Фл_ПослНом:  СекцШапкаСПР.Column[25].Visible = True;  СекцТелоСПР.Column[25].Visible = True;       СекцШапкаСПР.Column[25].Width = ШР_Послном*1;         СекцТелоСПР.Column[25].Width = ШР_ПослНом*1;
    else            СекцШапкаСПР.Column[25].Visible = False; СекцТелоСПР.Column[25].Visible = False;      СекцШапкаСПР.Column[25].Width = 0;                    СекцТелоСПР.Column[25].Width = 0;
    end;
  End;

  proc НастройкаСтолбцовПоУмолчанию;
    Фл_ПРЕКР            = false;        ШР_ПРЕКР        = 15;
    Фл_N_ГОСРЕГ         = true ;        ШР_N_ГОСРЕГ     = 30;
    Фл_ISSN             = false;        ШР_ISSN         = 20;
    Фл_НАЗВ             = true ;        ШР_НАЗВ         = 80;
    Фл_НАЗВ_ИН          = false;        ШР_НАЗВ_ИН      = 40;
    Фл_НАЗВ_НАЦ         = false;        ШР_НАЗВ_НАЦ     = 40;
    Фл_ПОДЗАГ           = true ;        ШР_ПОДЗАГ       = 60;
    Фл_ТГ               = false;        ШР_ТГ           = 30;
    Фл_ГЕО              = false;        ШР_ГЕО          = 40;
    Фл_РЕД              = true ;        ШР_РЕД          = 70;
    Фл_ТФ               = true ;        ШР_ТФ           = 45;
    Фл_EMAIL            = false;        ШР_EMAIL        = 40;
    Фл_ТИ               = false;        ШР_ТИ           = 20;
    Фл_ТЕМ              = false;        ШР_ТЕМ          = 70;
    Фл_ЯЗ               = false;        ШР_ЯЗ           = 30;
    Фл_ЖАНР             = false;        ШР_ЖАНР         = 70;
    Фл_УЧР              = false;        ШР_УЧР          = 40;
    Фл_Дата1            = false;        ШР_Дата1        = 18;
    Фл_РЕДАКТОР         = true ;        ШР_РЕДАКТОР     = 40;
    Фл_ГОД_РЕГ          = false;        ШР_ГОД_РЕГ      = 20;
    Фл_ПЕРИОДИЧН        = false;        ШР_ПЕРИОДИЧН    = 30;
    Фл_СР_РАЗ_ТИРАЖ     = false;        ШР_СР_РАЗ_ТИРАЖ = 30;
    Фл_ЛППИ             = false;        ШР_ЛППИ         = 15;
    Фл_ПослНом          = false;        ШР_ПослНом      = 25;
  end;


--{ Обработчики событий бланка
  proc шаблон_ПриОткрытии(Create :Logical);
    try
    self.LoadObject("БибСправкаГазеты01");
    except
    НастройкаСтолбцовПоУмолчанию;
    end;
    фреймУсловияОтбора.Visible          = true;
    фреймНастройкаСтолбцов.Visible      = false;
    ВидСекцииУсловияотбора;
    ОформитьОтчет;
  end;

  proc КнНастройка_ПриНажатии(Sender :Button);
    if ПоказатьНастройку = false then
      фреймУсловияОтбора.Visible        = false;
      фреймНастройкаСтолбцов.Visible    = true;
      фреймРезультат.Visible            = false;
      ПоказатьНастройку                 = true;
    else
      фреймУсловияОтбора.Visible        = true;
      фреймНастройкаСтолбцов.Visible    = false;
      фреймРезультат.Visible            = true;
      ПоказатьНастройку                 = false;
      ОформитьОтчет;
    end;
  end;

  proc ПостроениеОтчета(ФильтрГазет:string);
    var Q,Q2            : query;
    var k               : integer;
    var rec             : record;
      ----------------------------------------------
      СекцТелоСПР.Count         = nil;
      NNN                       = nil;
      ПРЕКР                     = nil;
      N_ГОСРЕГ                  = nil;
      ISSN                      = nil;
      НАЗВ                      = nil;
      НАЗВ_ИН                   = nil;
      НАЗВ_НАЦ                  = nil;
      ПОДЗАГ                    = nil;
      ТГ                        = nil;
      ГЕО                       = nil;
      РЕД                       = nil;
      ТФ                        = nil;
      EMAIL                     = nil;
      ТИ                        = nil;
      ТЕМ                       = nil;
      ЯЗ                        = nil;
      ЖАНР                      = nil;
      УЧР                       = nil;
      Дата1                     = nil;
      РЕДАКТОР_ГАЗЕТЫ           = nil;
      ГОД_РЕГ                   = nil;
      Периодичность_Газеты      = nil;
      СР_РАЗ_ТИРАЖ              = nil;
      ЛППИ                      = nil;
      ПослНом                   = nil;
      Газета                    = nil;
      ----------------------------------------------
      Q                 = Query.Create([РКП_Газеты.Газета]);
      Q.Order           = "НазваниеОсн";
      Q.Filter          = ФильтрГазет;
      Q.Select;
      Q.First;
        for k =  1..Q.Count       do
          Hint("Выборка данных...",k,Q.Count);
          NNN[k]        = k;
          --Газета[k]               = Q.Current.DocId;
          Газета[k]               = Q.Current;
          if Фл_ПРЕКР           = true          then
            ПРЕКР[k]            = Q.Current.Прекращено;
          end;
          if Фл_N_ГОСРЕГ        = true          then
            N_ГОСРЕГ[k]         = Q.Current.РегНомер;
          end;
          if Фл_ISSN            = true          then
            ISSN[k]             = Q.Current.ISSN;
          end;
          if Фл_НАЗВ            = true          then
            НАЗВ[k]             = Q.Current.НазваниеОсн;
          end;
          if Фл_НАЗВ_ИН         = true          then
            НАЗВ_ИН[k]          = Q.Current.НазваниеИнЯз;
          end;
          if Фл_НАЗВ_НАЦ        = true          then
            НАЗВ_НАЦ[k]         = Q.Current.НазваниеНацЯз;
          end;
          if Фл_ПОДЗАГ          = true          then
            ПОДЗАГ[k]           = Q.Current.Подзаголовок;
          end;
          if Фл_ТГ              = true          then
            ТГ[k]               = Q.Current.ТерриторияРаспространения;
          end;
          if Фл_ГЕО             = true          then
            if Q.Current.МестаИздания.Count > 0 then
            ГЕО[k]              = Q.Current.МестаИздания.Items[1].МестоИздания;
            end;
          end;
          if Фл_РЕД             = true          then
            РЕД[k]              = Q.Current.Редакция;
          end;
          if Фл_ТФ              = true          then
            ТФ[k]               = Q.Current.Телефон;
          end;
          if Фл_EMAIL           = true          then
            EMAIL[k]            = Q.Current.E_mail;
          end;
          if Фл_ТИ              = true          then
            ТИ[k]               = Q.Current.ТипИздания;
          end;
          if Фл_ТЕМ             = true          then
            if Q.Current.Тематики.Count > 0     then
              ТЕМ[k]            = Q.Current.Тематики.Items[1].Тематика;
            end;
          end;
          if Фл_ЯЗ              = true          then
            if Q.Current.Языки.Count > 0        then
              ЯЗ[k]             = Q.Current.Языки.Items[1].Язык;
            end;
          end;
          if Фл_УЧР             = true          then
            УЧР[k]              = Q.Current.Учред;
          end;
          if Фл_Дата1           = true          then
            if Q.Current.ДатаВыходаПервогоНомера>01.01.1990     then
              if        Q.Current.ТочностьДатыПервогоНомера = 0 then
                Дата1[k]        = Str(Q.Current.ДатаВыходаПервогоНомера);
              elsif     Q.Current.ТочностьДатыПервогоНомера = 1 then
                Дата1[k]        =   РКП_СИС.DateDescription.ToString(Q.Current.ДатаВыходаПервогоНомера, РКП_СИС.DateDescription.dfYYYYMMM);
              elsif     Q.Current.ТочностьДатыПервогоНомера = 2 then
                Дата1[k]        = Str(Year(Q.Current.ДатаВыходаПервогоНомера))+' г.';
              end;
            end;
          end;
          if Фл_РЕДАКТОР        = true          then
            РЕДАКТОР_ГАЗЕТЫ[k]  = Q.Current.РедакторГазеты;
          end;
          if Фл_ГОД_РЕГ         = true          then
            ГОД_РЕГ[k]          = Q.Current.ГодЛетописи;
          end;
          if Фл_ПЕРИОДИЧН       = true          then
            Периодичность_ГАЗЕТЫ[k]             = Q.Current.Периодичность;
          end;
          if Фл_СР_РАЗ_ТИРАЖ    = true          then
            Q2                  = Query.Create([РКП_Газеты.ПоступлениеГазеты]);
            Q2.Order            = "ГодПоступления";
            Q2.Filter           = "Газета="+Str(Q.Current);
            Q2.Select;
            if Q2.Count>0       then
              Q2.Last;
              СР_РАЗ_ТИРАЖ[k]   = Q2.Current.СреднийРазовыйТираж;
            end;
            Q2.Close;
          end;
          if Фл_ЛППИ            = true          then
            if Q.Current.ГодЛетописи>0          then
            ЛППИ[k]             = Str(Q.Current.ГодЛетописи);
              if Q.Current.НомерВЛетописи<>nil  then
                ЛППИ[k]         = ЛППИ[k]+" / "+Str(Q.Current.НомерВЛетописи);
              end;
            end;

          end;
          if Фл_ЖАНР            = true          then
            ЖАНР[k]             = Q.Current.ЖАНР;
          end;
          if Фл_ПослНом         = true          then
            rec                 = РКП_ГАЗЕТЫ.Стат.ПоследнийПолученныйНомер(Q.Current);
            if rec<>nil                         then
              ПослНом[k]        = rec.Номер;
              if  rec.ДатаВыхода>01.01.1990 then
                ПослНом[k]      = ПослНом[k]+' от '+str(rec.ДатаВыхода);
              end;
            end;
          end;
          --------------------------------
          Q.Next;
        end;
      Q.Close;
      СекцТелоСПР.Count         = k-1;
  end;

  proc КнРасчет_ПриНажатии(Sender :Button);
    var локФорма :UserObject;
    локФорма  = РКП_Газеты.УчетГазет.Запросы.блОтборГазетСпр1.Create;
    if  CmOk = локФорма.Show(Window.ModalWindow)        then
      МестоИздания              = локФорма.МестоИздания;
      ТипИздания                = локФорма.ТипИздания;
      Периодичность             = локФорма.Периодичность;
      ТерриторияРаспространения = локФорма.ТерриторияРаспространения;
      Тематика                  = локФорма.Тематика;
      ЧАЦН                      = локФорма.ЧАЦН;
      Язык                      = локФорма.Язык;
      ГодНачалаИздания          = локФорма.ГодНачалаИздания;
      ГодЛППИ                   = локФорма.ГодЛППИ;
      ГодВыпуска                = локФорма.ГодВыпуска;
        -----------------
        ПостроениеОтчета(локФорма.ПолучитьУсловиеОтбораГазет);
        -----------------
      ПоказатьНастройку         = true;
      КнНастройка_ПриНажатии(кнНастройка);
      кнНастройка.State         = false;
      ОформитьОтчет;
    end;
    ВидСекцииУсловияотбора;
  end;

  func КнВосстановитьНастройкуСтолбцов(Cell :TemplateCell;Action :Template.ClickTypes) :Logical;
    НастройкаСтолбцовПоУмолчанию;
    Result = False;
  end;

  func ОтрытьГазету(Cell :TemplateCell; Action :Template.ClickTypes) :Logical;
    var Index   : integer;
    var UForm   : BlankForm;
    Index       = Cell.Frame;
    UForm       = РКП_Газеты.УчетГазет.редГазета.Create;
    UForm.ShowEx(Газета[Index],Window.ModalWindow);
     
    Result = True; -- Разрешаем стандартную обработку
  end;


  proc шаблон_ПриЗакрытии(Destroy :Logical);
    self.SaveClass("БибСправкаГазеты01");
  end;

--}

end