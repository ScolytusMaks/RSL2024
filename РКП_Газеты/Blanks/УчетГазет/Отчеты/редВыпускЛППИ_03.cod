class inherited УчетГазет.Отчеты.РедВыпускЛППИ_02 "";

inclass

inobject

--------------------------------------------------------------------------------
--{ Обработчики событий бланка
var СтрокаЯзУказателя[]:string;

 proc АнализЯзыковИзданий;
    var Q                       : Query;
    var k                       : integer;
    var Qg                      : Query;
    var kg                      : integer;
    var j                       : integer;
    var h                       : integer;
    var НазваниеОсн             : string;
    СтрокаЯзУказателя   = nil;
    Q                   = Query.Create([РКП_Справочники.СпрЯзыкИздания]);
    Q.Filter            = "ГосЯзРФ=false";
    Q.Order             = "Наим";
    Q.Select;
    Q.First;
    for k = 1..Q.Count  do
    Hint("Указатель языков...",k,Q.Count);
      Qg                = Query.Create([РКП_Газеты.Газета]);
      --Qg.Filter         = "(ПризнакОтсылки=false and ГодЛетописи="+Str(ГодЛетописи)+") ";
      Qg.Filter         = "(ГодЛетописи="+Str(ГодЛетописи)+") ";
      Qg.Filter         = Qg.Filter+" and Языки.Exists(Язык.DocId="+Str(Q.Current.DocId)+")";
      Qg.Select;
      if Qg.Count>0     then
        j               = j+1;
        СтрокаЯзУказателя[j]    = "|";
        j               = j+1;
        СтрокаЯзУказателя[j]    = "/*"+Q.Current.Наим+"*/";
        j               = j+1;
        СтрокаЯзУказателя[j]    = "|";
        Qg.First;
        for kg = 1..Qg.Count                    do
          for h = 1..Qg.Current.Языки.Count     do
            if Qg.Current.Языки.Items[h].Язык.ГосЯзРФ=false     then
              j                         = j+1;
              НазваниеОсн=Qg.Current.НазваниеОсн;
              if Pos(" = ",НазваниеОсн)>0 then
                НазваниеОсн     = SubStr(НазваниеОсн,Pos(" = ",НазваниеОсн)+3,Length(НазваниеОсн))+
                                  " = "+
                                  SubStr(НазваниеОсн,1,Pos(" = ",НазваниеОсн)-1);
              end;
              if Qg.Current.ПризнакОтсылки=false                then
              СтрокаЯзУказателя[j]      = "    "+НазваниеОсн;
                if Qg.Current.МестаИздания.Count>0              then
                СтрокаЯзУказателя[j]    = СтрокаЯзУказателя[j]+". "+Qg.Current.МестаИздания.Items[1].МестоИздания.Наим;
                end;
              СтрокаЯзУказателя[j]      = СтрокаЯзУказателя[j]+" "+Str(Qg.Current.НомерВЛетописи);
              else
              if  Qg.Current.Отсылка<>nil  and Qg.Current.Отсылка.ГодЛетописи=ГодЛетописи        then
              СтрокаЯзУказателя[j]      = "    "+SubStr(НазваниеОсн,1,Pos('. - ',НазваниеОсн)-1);
--                if Qg.Current.МестаИздания.Count>1              then
                if Qg.Current.МестаИздания.Count>0              then
                СтрокаЯзУказателя[j]    = СтрокаЯзУказателя[j]+". "+Qg.Current.МестаИздания.Items[1].МестоИздания.Наим;
                end;
              СтрокаЯзУказателя[j]      = СтрокаЯзУказателя[j]+" "+Str(Qg.Current.Отсылка.НомерВЛетописи);
              end;
              end;
            end;
          end;
        Qg.Next;
        end;
      end;
      Qg.Close;
      Q.Next;
    end;
    Q.Close;
 end;



  proc СозданиеЯзУказателя;
    var k       : integer;
    var ЛППИ    : TextFile;
    АнализЯзыковИзданий;
    -------
    if    ExistFolder(ПапкаЛППИ) = false                        then
      CreateFolder(ПапкаЛППИ);
    end;
    if  ExistFile(ПапкаЛППИ+"\ЯзУказатель.txt") = true     then
      RemoveFile(ПапкаЛППИ+"\ЯзУказатель.txt");
    end;
    ЛППИ        = TextFile.Create(ПапкаЛППИ+"\ЯзУказатель.txt",fmCreate);
    ------
    ЛППИ.WriteLn("");
    ЛППИ.WriteLn("УКАЗАТЕЛЬ ГАЗЕТ, ИЗДАЮЩИХСЯ НА ЯЗЫКАХ НАРОДОВ");
    ЛППИ.WriteLn("РОССИЙСКОЙ ФЕДЕРАЦИИ (КРОМЕ РУССКОГО)");
    ЛППИ.WriteLn("И НА ИНОСТРАННЫХ ЯЗЫКАХ");
    ЛППИ.WriteLn("");
    for k=1..LengthOfArray(СтрокаЯзУказателя)                   do
      Hint("Формирование файла...",k,LengthOfArray(СтрокаЯзУказателя));
      if СтрокаЯзУказателя[k]<>""                               and
         СтрокаЯзУказателя[k]<>"|"                              then
      ЛППИ.WriteLn(СтрокаЯзУказателя[k]);
      end;
      if СтрокаЯзУказателя[k]="|"                               then
      ЛППИ.WriteLn("");
      end;
    end;
    end;

--}

end