class inherited СИС2.БазовыйБланкРедактор "Проверка", editor ВыпускЛГС;

inclass

inobject

--------------------------------------------------------------------------------
--{ Обработчики событий бланка
  func ПроверкаКорректности     : logical;
    var ДопИнформация           : string;
    var k                       : integer;
     --1.Проверить, что нет летописей, сверстаных позже
     --2.Проверить, что нет летописей, НЕ сверстаных ранее
     --3.Проверить, что нет НЕ сверстанных выпусков ПК
    var Q                       : Query;
    var РешениеПродолжить       : logical;
        --1.Проверить, что нет летописей, сверстаных позже
    Q                           = Query.Create([РКП_Статьи.ВыпускЛГС]);
    Q.Filter                    = "ГодЛетописи="+Str(ГодЛетописи)+
                                  " and ВыпускЛетописи>"+Str(ВыпускЛетописи)+
                                  " and ЛетописьСверстана=true";
    Q.Select;
    if      Q.Count>0                   then
      Message("В базе данных имеются сверстанные выпуски летописей, выходящие позже редактируемого. "+
              "Если эти выпуски были сверстаны ошибочно, сбросьте флаг <Выпуск сверстан> во всех выпусках "+
              "этого года, больших №"+Str(ВыпускЛетописи)+".");
      РешениеПродолжить         = false;
    else
      РешениеПродолжить         = true;
    end;
    Q.Close;
    ---
    --2.Проверить, что нет летописей, НЕ сверстаных ранее
    if РешениеПродолжить        = true  then
      Q                         = Query.Create([РКП_Статьи.ВыпускЛГС]);
      Q.Filter                  = "ГодЛетописи="+Str(ГодЛетописи)+
                                  " and ВыпускЛетописи<"+Str(ВыпускЛетописи)+
                                  " and ЛетописьСверстана=false";
      Q.Select;
      if      Q.Count>0                 then
        Message("В базе данных имеются не сверстанные выпуски летописей, выходящие ранее редактируемого. "+
                "Обработка этого выпуска невозможна без обработки предыддущих!");
        РешениеПродолжить       = false;
      else
        РешениеПродолжить       = true;
      end;
      Q.Close;
    end;
    --
    --3.Проверить, что нет НЕ сверстанных выпусков ПК
    if РешениеПродолжить        = true  then
      Q                         = Query.Create([РКП_Статьи.Роспись]);
      Q.Filter                  = "ГодЛетописи="+Str(ГодЛетописи)+
                                  " and ВыпускЛетописи="+Str(ВыпускЛетописи)+
                                  " and (ДатаКарточек<>nil"+
                                  " and СтатусПК=false)";
      Q.Select;
        if Q.Count = 0                  then
          РешениеПродолжить     = true;
        else
          Q.First;
          for k = 1..Q.Count    do
           if k<11              then
             if k=1             then
               ДопИнформация    = Chr(13)+"<"+SubStr(Q.Current.НазваниеСтатьи,1,25)+"...>";
             else
               ДопИнформация    = ДопИнформация+Chr(13)+"<"+SubStr(Q.Current.НазваниеСтатьи,1,25)+"...>";
             end;
           else
               ДопИнформация    = ДопИнформация+Chr(13)+"...";
             Break;
           end;
          Q.Next;
          end;
        Message("В базе данных имеются не сверстанные выпуск(и) печатных каталожных карточек, входящих в этот выпуск <Летописи>. "+
                "Обработка выпуска ЛГС невозможна без обработки выпуска печатных каталожных карточек!"+Chr(13)+"    Статьи:"+ДопИнформация);
          РешениеПродолжить     = false;
        end;
      Q.Close;
    end;
    Return РешениеПродолжить;
  end;
--}

end