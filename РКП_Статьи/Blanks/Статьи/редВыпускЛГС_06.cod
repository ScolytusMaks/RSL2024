class inherited Статьи.редВыпускЛГС_05 "Создание указателя ВТР", editor ВыпускЛГС;

inclass

inobject
  var У_ВТР[]                   : record;
  var У_ЛГС[]                   : string;
      секцУ_ВТР                 : Section;


--------------------------------------------------------------------------------
--{ Обработчики событий бланка
  proc СозданиеУказателяВТР;
    var Q                       : Query;
    var k,i,n0,n1               : integer;
    var r0,r1                   : record;
    --очистки позиций
    секцУ_ВТР.Count             = 0;
    Record.УказательВТР.Clear;
    --выборка данных
    Q                           = Query.Create([РКП_Статьи.Роспись]);
    Q.Filter                    = "ГодЛетописи="+Str(ГодЛетописи)+" and ИндексВТР<>nil";
    Q.Order                     = "ИндексВТР;ВыпускЛетописи";
    Q.Select;
    Q.First;
    for k = 1..Q.Count          do
      r1                        = Q.Current.ИндексВТР;
      n1                        = Q.Current.ВыпускЛетописи;
      if r1<>r0                 then
        i                       = i+1;
        У_ВТР[i]                = r1;
      end;
      if n1<>n0                 then
        if У_ЛГС[i]=""          then
          У_ЛГС[i]              = "№ "+Str(Q.Current.ВыпускЛетописи);
        else
          if n1<>n0             then
          У_ЛГС[i]              = У_ЛГС[i]+", "+Str(Q.Current.ВыпускЛетописи);
          end;
        end;
      end;
      r0                        = r1;
      n0                        = n1;
      Q.Next;
    end;
    --сортировка согласно УДК
    секцУ_ВТР.Count             = i;
    секцУ_ВТР.SortBy("У_ВТР.Код");
    секцУ_ВТР.SortBy("У_ВТР.Номер");--26.12.2008
    --запись в п/т
    for k = 1..секцУ_ВТР.Count  do
      Record.УказательВТР.Add;
      Record.УказательВТР[k].Рубрика    = У_ВТР[k];
      Record.УказательВТР[k].НомераЛГС  = У_ЛГС[k];
    end;
  end;

  proc СодержаниеИСтраницы;
      #Warning "Создать отдельный массив для содержания,";
      --подсчитать строки в содержании, вновь вычислить номера страниц для всего выпуска ЛГС

  end;



  proc Тест_ПриНажатии(Sender :Button);
   СозданиеУказателяВТР;
  end;

--}

end