class inherited —татьи.редвыпускЋ√—_08 "ѕодготовка выпуска Ћ√— - экспорт в – ѕ", editor ¬ыпускЋ√—;
Import – ѕ_—»— Classes StdCode;

inclass

inobject

--------------------------------------------------------------------------------
--{ ќбработчики событий бланка
  proc ‘ормирование‘айла;
  var а»м€ѕапки         : string;
  var а»м€‘айла         : string;
  var а‘айл             : TextFile;
  var Q                 : Query;
  var k,kk              : integer;
  var z,zz              : integer;
  var Ўифр¬ыпуска_      : string;
  а»м€ѕапки             = ѕапка‘айлаЁкспрта;
  а»м€‘айла             = ‘айлЁкспорта;
----ѕроверка шифра (13.01.2009)----------------------------------------------------------------------------
   Ўифр¬ыпуска_        = "GL"+
                         SubStr(Str(√одЋетописи),3,2)+"-"+
                         FixStr(Str(¬ыпускЋетописи),"0",2);
   if Ўифр¬ыпуска<>Ўифр¬ыпуска_                         then
     Ўифр¬ыпуска        = Ўифр¬ыпуска_;
   end;
----—оздание файла-----------------------------------------------------------------------------------------
    if    ExistFolder(а»м€ѕапки) = false                then
         CreateFolder(а»м€ѕапки);
    end;
    if  ExistFile(а»м€‘айла) = true                     then
         RemoveFile(а»м€‘айла);
    end;
    а‘айл       = TextFile.Create(а»м€‘айла,fmCreate,false);--DOS 28.01.2009
----Ќаполнение файла содержимым----------------------------------------------------------------------------
      Q                         = Query.Create([– ѕ_—татьи.–оспись]);
      Q.Filter                  = "√одЋетописи="+Str(√одЋетописи)+
                                  " and ¬ыпускЋетописи="+Str(¬ыпускЋетописи);
      Q.Order                   = "Ќомер«аписи¬¬ыпуске√Ћ";
      Q.Select;
      kk                        = Q.Count;
      if  kk > 0                                        then
        Q.First;
--                а‘айл.WriteLn(FixStr(Str(Year(Now)),"0",2)+
--                              FixStr(Str(Mon(Now)),"0",2)+
--                              FixStr(Str(Day(Now)),"0",2)+
--                              FixStr(Str(Hour(Now)),"0",2)+
--                              FixStr(Str(Minute(Now)),"0",2));          --идентификатор (дата и врем€ создани€)
        for k = 1..kk                                   do
                --а‘айл.WriteLn("000 "+FixStr(Str(k),"0",8));
                а‘айл.WriteLn("000"+FixStr(Str(k),"0",8));--без пробела 28.01.2009
                if Q.Current.Ўифр арточек <> nil        then
                а‘айл.WriteLn("001 √Ћѕ√");
                else
                а‘айл.WriteLn("001 √Ћ");
                end;
                if Q.Current.Ўифр арточек <> nil        then

                а‘айл.WriteLn("003 "+Up(Ўифр¬ыпуска)+" ^1 "+Q.Current.Ўифр арточек);

                else
                а‘айл.WriteLn("003 "+Up(Ўифр¬ыпуска));
                end;
          zz                   = Q.Current.Ёкспорт– ѕ.Count;
            for z = 1..zz                               do
              if Length(Q.Current.Ёкспорт– ѕ.Items[z].ƒанные)>4      then
              if Pos('053 ',Q.Current.Ёкспорт– ѕ.Items[z].ƒанные)<>1 then
                if Pos('^',Q.Current.Ёкспорт– ѕ.Items[z].ƒанные)>0   then
                а‘айл.WriteLn(ќригиналћакет.ќбработка“екста.«амена–егистра»дентификаторов(Q.Current.Ёкспорт– ѕ.Items[z].ƒанные));
                #Warning "”далить во второй половине 2009 года";
                else
                а‘айл.WriteLn(Q.Current.Ёкспорт– ѕ.Items[z].ƒанные);
                end;
              end;
              end;
            end;
                if Q.Current.Ќомер«аписи¬¬ыпускеѕ <>nil then
                а‘айл.WriteLn("011 "+Str(Q.Current.Ќомер«аписи¬¬ыпускеѕ ));
                end;
                а‘айл.WriteLn("015 "+Str(Q.Current.Ќомер«аписи¬¬ыпуске√Ћ));--
                if Q.Current.ƒата арточек<>nil          then
                а‘айл.WriteLn("053 "+
                FixStr(Str(Day(Q.Current.ƒата арточек)),"0",2)+"."+
                FixStr(Str(Mon(Q.Current.ƒата арточек)),"0",2)+"."+
                FixStr(Str(Year(Q.Current.ƒата арточек)),"0",2));
                --Str(Q.Current.ƒата арточек));
                end;
                а‘айл.WriteLn("_");
          Q.Next;
        end;

      end;
    --ExecuteProgram(а»м€ѕапки);
  end;

--}

end