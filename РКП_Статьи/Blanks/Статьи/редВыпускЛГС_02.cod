class inherited Статьи.редВыпускЛГС_01 "Создание указателя УДК", editor ВыпускЛГС;

inclass

inobject
  var ИндексУДК_[]              : РКП_Справочники.СпрТематикаСтатьи;

--------------------------------------------------------------------------------
--{ Обработчики событий бланка
  proc СозданиеУказателяУДК;
    var Q0,Q1                   : Query;
    var k1,j,jj,i               : integer;
    --Содержание------------------------------------------------------------------
      --организация запроса к справочнику УДК, отсортированного по коду УДК
      Q1                        = Query.Create([РКП_Справочники.СпрТематикаСтатьи]);
      --Q1.Filter                 = "Временная=false";
      Q1.Order                  = "КодУДК";
      Q1.Order                  = "Номер";--26.12.2008
      Q1.Select;
      --организация цикла
      Q1.First;
        for k1 = 1..Q1.Count            do
          --Проверка первого (корневого) уровня
          Q0                    = Query.Create([РКП_Статьи.Роспись]);
          Q0.Filter             = "ГодЛетописи="+Str(ГодЛетописи)+
                                  " and ВыпускЛетописи="+Str(ВыпускЛетописи)+
                                  " and (ИндексУДК.Exists(Match(РубрикаУДК.Код,'"+Str(Q1.Current.Код)+"*')) or"+
                                  " Match(ИндексВТР.Код,'"+Str(Q1.Current.Код)+"*'))";
          Q0.LoadingFieldsMode  = СИС2.Константы.mdNone;
          Q0.Select;
          if Q0.Count>0 then
            j                   = j + 1;
            ИндексУДК_[j]       = Q1.Current;
          end;
          Q0.Close;
          --#Warning "Включить в указатель временные тематические рубрики";
          Q1.Next;
        end;
      Q1.Close;
    --
    for j = 1..LengthOfArray(ИндексУДК_)                do
      if    УказательУДК.Count < j                      then
        i       = Record.УказательУДК.Add;
      elsif УказательУДК.Count >=j                      then
        i       = i + 1;
      end;
      if УказательУДК[i].ИндексУДК<>ИндексУДК_[j]       then
        УказательУДК[i].ИндексУДК       = ИндексУДК_[j];
      end;
    end;
    jj  = УказательУДК.Count;
    if LengthOfArray(ИндексУДК_)>0                      then
    for j = LengthOfArray(ИндексУДК_)+1..jj             do
      Record.УказательУДК.Delete(j);
    end;
    end;
  end;

--}

end
